parameters:
- name: buildDirectories
  type: object

steps:
- script: mkdir -p terraform/build/
  displayName: Make Lambda .zip Directory

- ${{ each sourceDirectory in parameters.buildDirectories }}:
  - ${{ if ne(sourceDirectory.packageAs, 'image') }}:
    - download: current
      artifact: ${{ replace(sourceDirectory.path, '/', '_')}}
      displayName: Get ${{ sourceDirectory.path }} Artifact

    - script: mv $(Pipeline.Workspace)/${{ sourceDirectory.path }}/* terraform/build
      displayName: Stage ${{ sourceDirectory.path }} Artifact
