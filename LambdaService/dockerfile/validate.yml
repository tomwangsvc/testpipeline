parameters:
- name: directory
  type: string

steps:  
- checkout: self
  submodules: true

- task: npmAuthenticate@0
  inputs:
    workingFile: 'lambdas/${{ parameters.directory }}/.npmrc'

- task: Docker@2
  inputs:
    command: build
    Dockerfile: 'dockerfiles/lambda/nodejs/Dockerfile'
    repository: ${{ parameters.directory }}
    tags: latest
    arguments: '--secret id=npmrc-package,src=.npmrc'