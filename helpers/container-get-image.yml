parameters:
- name: buildContainerImage
  type: string
  default: ''

steps:
# use the buildContainerImage param if set, otherwise find the devcontainer image url
- ${{ if ne(parameters.buildContainerImage, '') }}:
  - script: echo "##vso[task.setvariable variable=url;isOutput=true]${image}"
    displayName: Get Image
    name: GetImage
    env: 
      image: ${{ parameters.buildContainerImage }}

- ${{ if eq(parameters.buildContainerImage, '') }}:
  - script: |
      variant=$(jq -er '.build.args.VARIANT | select (.!=null)' devcontainer.json || sed '/^ARG VARIANT=/!d;s|.*=||;s|^"||;s|"$||' Dockerfile)
      image=$(jq -er '.image | select (.!=null)' devcontainer.json || sed '/FROM/!d;s|FROM ||;s|${VARIANT}|'"${variant}|" Dockerfile)
      echo "##vso[task.setvariable variable=url;isOutput=true]${image}"
    displayName: Get Image
    name: GetImage
    workingDirectory: $(Build.SourcesDirectory)/.devcontainer