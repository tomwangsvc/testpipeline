parameters:
- name: terraformVersion
  type: string
  default: ''
- name: steps
  type: stepList

steps:
- task: TerraformInstaller@0
  displayName: Install Terraform
  condition: ne('${{ parameters.terraformVersion }}', '')
  inputs:
    terraformVersion: ${{ parameters.terraformVersion }}

- task: TerraformTaskV1@0
  displayName: Initialise Terraform
  inputs:
    provider: $(TF_PROVIDER)
    command: init
    workingDirectory: $(TF_PATH)
    commandOptions: -backend-config=role_arn=$(TF_ROLE_ARN)
    backendServiceAWS: $(TF_SERVICE_CONNECTOR)
    backendAWSBucketName: $(TF_BACKEND_BUCKET)
    backendAWSKey: $(TF_BACKEND_KEY)

- ${{ each step in parameters.steps }}:
  - ${{ step }}